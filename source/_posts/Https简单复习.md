---
title: Https简单复习.md
date: 2017-03-18 17:02:43
category: iOSTips
tags:
---
### HTTPS简单复习
![](http://o7vzr7y09.bkt.clouddn.com/440px-Internet2.jpg)
现在全站HTTPS的时代已经到来了,最近把https的概念复习了一下
https在http请求的基础上多加了一个证书认证的流程。认证通过之后，数据传输都是加密进行的。
https的认证过程分为单项认证和双项认证
#### 单项认证过程
![](http://upload-images.jianshu.io/upload_images/2702646-c6f158b5d4ad4602.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

1. 客户端发起HTTPS请求
这个没什么好说的，就是用户在浏览器里输入一个https网址，然后连接到server的443端口(http的默认TCP端口是80)。这里客户端传递的内容中包括SSL协议版本,支持的加密算法和一个随机数1.
2. 服务端的配置
采用HTTPS协议的服务器必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面。
　　这套证书其实就是一对公钥和私钥。如果对公钥和私钥不太理解，可以想象成一把钥匙和一个锁头，只是全世界只有你一个人有这把钥匙，你可以把锁头给别人，别人可以用这个锁把重要的东西锁起来，然后发给你，因为只有你一个人有这把钥匙，所以只有你才能看到被这把锁锁起来的东西。
3. 传送证书
　　这个证书其实就是公钥，只是包含了很多信息，如证书的颁发机构，过期时间等等,同时告诉客户端将使用的加密算法,还有随机数2。
4. 客户端解析证书
　这部分工作是有客户端的TLS/SSL来完成,大概有下面几个步骤:
    * 证书是否过期
    * 发型服务器证书的CA是否可靠
    * 返回的公钥是否能正确解开返回证书中的数字签名
    * 服务器证书上的域名是否和服务器的实际域名相匹配  
        
  如果发现异常，则会弹出一个警告框，提示证书存在问题。如果证书没有问题，那么就生成一个随机值3。然后用证书对该随机值进行加密。就好像上面说的，把随机值用锁头锁起来，这样除非有钥匙，不然看不到被锁住的内容。
5. 传送加密信息
    将随机数传递给服务器
6. 服务段解密信息
　　服务端用私钥解密后，得到了客户端传过来的随机值，这样服务器和客户端都有了三套随机数,然后服务端和客户端各使用之前约定的加密算法生成对称秘钥(session key),然后把内容通过该值进行对称加密。所谓对称加密就是，将信息和私钥通过某种算法混合在一起，这样除非知道私钥，不然无法获取内容，而正好客户端和服务端都知道这个私钥，所以只要加密算法够彪悍，私钥够复杂，数据就够安全。
7. 传输加密后的信息
　　这部分信息是服务端用私钥加密后的信息，可以在客户端被还原。
8. 客户端解密信息
　　客户端用之前生成的对称秘钥解密服务段传过来的信息，于是获取了解密后的内容。整个过程第三方即使监听到了数据，也束手无策。

这就是整个https验证的流程了,这里省略了中间客户端传递自己支持的加密算法的步骤。简单总结一下：

* 首先服务端要有一对秘钥
用户发起请求，服务器响应后返回一个证书(公钥)，证书中包含一些基本信息(证书的颁发机构,证书过期时间等)和公钥。
* 用户拿到证书后，去验证这个证书是否合法，不合法，则请求终止。
合法则生成一个随机数，作为对称加密的密钥，用服务器返回的公钥对这个随机数加密。然后返回给服务器。
* 服务器拿到加密后的随机数，利用私钥解密，然后再用解密后的随机数（对称密钥），把需要返回的数据加密，加密完成后数据传输给用户。
* 最后用户拿到加密的数据，用一开始的那个随机数（对称密钥），进行数据解密。整个过程完成。


##### 双向认证
双向认证和单向认证原理基本差不多，只是除了客户端需要认证服务端以外，增加了服务端对客户端的认证，具体过程如下：
![](http://img.blog.csdn.net/20160310160519781)

##### 对称加密&非对称加密
上面提到了对称加密和非对称加密,他们有什么区别呢

* 对称加密: 速度高，可加密内容较大，用来加密**会话过程**中的消息
* 非对称加密: 加密速度较慢，但能提供更好的身份认证技术，用来加密对称加密的密钥

上面SSL单项认证过程中客户端使用服务端的公钥加密随机数的过程就是非对称加密,又称为公钥加密,服务端通过随机数将内容加密的过程就是对称加密.





